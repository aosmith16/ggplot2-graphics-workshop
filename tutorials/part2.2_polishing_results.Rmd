---
title: "Reshaping data"
output: 
  learnr::tutorial:
       progressive: TRUE
       allow_skip: TRUE
       ace_theme: "crimson_editor"
runtime: shiny_prerendered
description: "Using tidyr to reshape your data."
---

```{r setup, include = FALSE}
library(learnr)
library(ggplot2)
library(tidyr)
library(dplyr)
knitr::opts_chunk$set(error = TRUE)
```

```{r hex, echo = FALSE, out.width = "100px"}
knitr::include_graphics(path = "https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/ggplot2.png")
```

This is the final tutorial in a series of three.  Like the second tutorial, it will walk you through another example of making a "final" graphic in **ggplot2**. This example will cover some topics not covered yet, such as adding error bars and annotating the plot with rectangles and text.  Since this example involves a legend, you will also get to see examples of moving and controlling legend appearance.

I'm not advocating this as any sort of ideal final graphic, as a lot of plotting depends on personal preference and, potentially, manuscript requirements.  Instead, this example of the plotting process is done to expose you to more **ggplot2** options.

###
 
### Check package versions

The current version of **ggplot2** in April 2020 is 3.3.0.  If doing this tutorial in your own version of R you need to make sure you have this version (or newer).

You can use function `packageVersion()` to check for the currently installed version of a package.  If your package version is old, close this tutorial, reinstall the package using, for example, `install.packages("ggplot2")`, and then start again.

```{r package-vers, exercise = TRUE}
packageVersion("ggplot2")
```

Once you have an up-to-date version of **ggplot2**, load the package.  You're ready to get started!

```{r ggplot2, exercise = TRUE, message = FALSE, warning = FALSE}
library(ggplot2)
```

### The plotting dataset

The dataset to be plotted is called `res`, containing the estimated differences in mean growth of each group against the control group based on an analysis of mean growth vs two factors.  I pulled the estimated differences in means and the associated confidence intervals from the statistical model and saved the results.

```{r res}
res = structure(list(Diffmeans = c(-0.27, 0.11, -0.15, -1.27, -1.18
),
                    Lower.CI = c(-0.63, -0.25, -0.51, -1.63, -1.54), 
                    Upper.CI = c(0.09, 0.47, 0.21, -0.91, -0.82), 
                    plantdate = structure(c(2L, 3L, 3L, 1L, 1L), 
                      .Label = c("Feb25", "Jan2", "Jan28"), class = "factor"), 
                    stocktype = structure(c(2L, 2L, 1L, 2L, 1L), 
                      .Label = c("bare","cont"), class = "factor") ),  
                    class = "data.frame", row.names = c(NA, -5L) )
```

###

Take a quick look at the first six lines (with `head()`) and structure (with `str()`) of this dataset so you understand what it looks like.  The two factors used in the original analyses are `plantdate`, which has three levels that indicate the date that trees were planted, and `stocktype`, which has two levels and indicates the kind of stock (either bare root or in a container).  The control group was bare root trees planted on January 2.  There were six groups including the control group, and so there are five comparisons in this table of results. 

The goal will be to make a plot with estimated means and confidence intervals as error bars to display these results.

```{r head-res, exercise = TRUE}
head(res)
```

```{r str-res, exercise = TRUE}
str(res)
```

### Factor order controls axis order

After going through the previous tutorials, you now know that it is often easiest to clean up the dataset prior to making the plot.  Along those lines, I'll start by making some changes to the `plantdate` variable.  The levels of `plantdate` aren't in date order because R by default orders levels of factors alphanumerically.  I can control the display order of a factor in **ggplot2** by changing the order of the factor levels in the dataset.  I also relabel the levels of the factor to make them look nicer to save myself some work later.

```{r factor}
res$plantdate = factor(res$plantdate, 
				   levels = c("Jan2", "Jan28", "Feb25"),
				   labels = c("January 2", "January 28", "February 25") )
```